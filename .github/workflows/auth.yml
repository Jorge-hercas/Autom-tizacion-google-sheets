name: Run auth.R (Windows)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * *"  # todos los dÃ­as a las 6 AM UTC

jobs:
  run-r-script:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install R packages
        run: |
          Rscript -e "install.packages(c('alphavantager','dplyr','lubridate','googlesheets4','googledrive'), repos='https://cloud.r-project.org')"

      - name: Write service account key
        shell: bash
        run: |
          echo '${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}' > key.json

      - name: Run auth.R script
        run: |
          Rscript auth.R
